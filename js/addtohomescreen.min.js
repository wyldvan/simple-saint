/* Add to Homescreen Prompt v0.0.1 ~ (c) 2020 Chris Love ~ @license: https://love2dev.com/pwa/add-to-homescreen/ */ !function(e,i,n){"use strict";var t,o={},s={},a=!0,r={},d={appID:"com.love2dev.addtohome",appName:"Progressive Web App",debug:!1,logging:!1,modal:!1,mandatory:!1,autostart:!0,skipFirstVisit:!1,minSessions:0,startDelay:1,lifespan:15,displayPace:1440,mustShowCustomPrompt:!1,maxDisplayCount:0,validLocation:[],onInit:null,onShow:null,onAdd:null,onInstall:null,onCancel:null,customCriteria:null,manualPrompt:null};function l(e){return e.preventDefault(),r.onCancel&&r.onCancel(),!1}function u(e){return r.onInstall&&r.onInstall(e),_beforeInstallPrompt&&(!r.debug||"native"===p())&&f(),!1}function c(){var i=e.navigator.userAgent;o.isIDevice=/iphone|ipod|ipad/i.test(navigator.platform),o.isSamsung=/Samsung/i.test(i),o.isFireFox=/Firefox/i.test(i),o.isOpera=/opr/i.test(i),o.isEdge=/edg/i.test(i),o.isFireFox&&(o.isFireFox=/android/i.test(i)),o.isOpera&&(o.isOpera=/android/i.test(i)),o.isChromium="onbeforeinstallprompt"in e,o.isInWebAppiOS=!0===e.navigator.standalone,o.isInWebAppChrome=e.matchMedia("(display-mode: fullscreen)").matches||e.matchMedia("(display-mode: standalone)").matches||e.matchMedia("(display-mode: minimal-ui)").matches,o.isMobileSafari=o.isIDevice&&i.indexOf("Safari")>-1&&0>i.indexOf("CriOS"),o.isStandalone=o.isInWebAppiOS||o.isInWebAppChrome,o.isiPad=o.isMobileSafari&&i.indexOf("iPad")>-1,o.isiPhone=o.isMobileSafari&&-1===i.indexOf("iPad"),o.isCompatible=o.isChromium||o.isMobileSafari||o.isSamsung||o.isFireFox||o.isOpera||o.isIDevice}function p(e){if(r.debug&&"string"==typeof r.debug)return r.debug;if(o.isChromium&&e===n&&!e)return"native";if(o.isFireFox)return"firefox";if(o.isiPad)return"ipad";if(o.isiPhone)return"iphone";if(o.isOpera)return"opera";else if(o.isSamsung)return"samsung";else if(o.isEdge)return"edge";else if(o.isChromium)return"chromium";else return""}function m(e){if(s.shown&&!e){h("Add to homescreen: not displaying callout because already shown on screen");return}s.shown=!0,"interactive"===i.readyState||"complete"===i.readyState?A():i.onreadystatechange=function(){"complete"===i.readyState&&A()}}function f(){return _beforeInstallPrompt?_beforeInstallPrompt.prompt().then(function(e){return _beforeInstallPrompt.userChoice}).then(function(e){s.added="accepted"===e.outcome,s.added?(h("User accepted the A2HS prompt"),r.onAdd&&r.onAdd(e)):(r.onCancel&&r.onCancel(e),s.optedout=!0,h("User dismissed the A2HS prompt")),S(),_beforeInstallPrompt=null}).catch(function(e){if(h(e.message),e.message.indexOf("user gesture")>-1)r.mustShowCustomPrompt=!0,A();else{if(!(e.message.indexOf("The app is already installed")>-1))return console.log(e),e;console.log(e.message),s.added=!0,S()}}):Promise.resolve()}function g(e){localStorage.removeItem(e||ath.defaults.appID)}function h(e){r.logging&&(r.logger?r.logger.log(e):console.log(e))}function y(){!function e(){var i;if(a!==n)return a;if(a=!1,!function e(){if(null!==r.customCriteria||n!==r.customCriteria){var i=!1;return i="function"==typeof r.customCriteria?r.customCriteria():!!r.customCriteria,r.customCriteria=i,i||h("Add to homescreen: not displaying callout because a custom criteria was not met."),i}return!0}())return _canInstall=!1,!1;if(!o.isCompatible)return h("Add to homescreen: not displaying callout because device not supported"),!1;return Date.now()-s.lastDisplayTime<6e4*r.displayPace?(h("Add to homescreen: not displaying callout because displayed recently"),!1):r.maxDisplayCount&&s.displayCount>=r.maxDisplayCount?(h("Add to homescreen: not displaying callout because displayed too many times already"),!1):s.sessions<r.minSessions?(h("Add to homescreen: not displaying callout because not enough visits"),!1):r.nextSession&&r.nextSession>0&&s.sessions>=r.nextSession?(h("Add to homescreen: not displaying callout because waiting on session "+r.nextSession),!1):s.optedout?(h("Add to homescreen: not displaying callout because user opted out"),!1):s.added?(h("Add to homescreen: not displaying callout because already added to the homescreen"),!1):o.isStandalone?(!s.added&&(s.added=!0,S(),r.onAdd&&r.onAdd(t,s)),h("Add to homescreen: not displaying callout because in standalone mode"),!1):!s.returningVisitor&&(s.returningVisitor=!0,S(),r.skipFirstVisit)?(h("Add to homescreen: not displaying callout because skipping first visit"),!1):(a=!0,console.log("end canPrompt"),!0)}()?canInstall()&&r.onCanInstall&&r.onCanInstall(o,s,t):(t.beforeInstallPrompt="onbeforeinstallprompt"in e,r.onShow&&r.onShow(o,s,t),s.lastDisplayTime=Date.now(),s.displayCount++,S())}function C(){y()}function S(){localStorage.setItem(r.appID,JSON.stringify(s))}function _(){s=_defaultSession,S()}function b(){s.optedout=!0,S()}function $(){s.optedout=!1,S()}function v(){s.displayCount=0,S()}function A(e){setTimeout(y(),1e3*r.startDelay+500)}e.a2hsPrompt=function e(i){return t||(t={trigger:C,updateSession:S,clearSession:_,removeSession:g,optOut:b,optIn:$,clearDisplayCount:v,triggerNativePrompt:f,options:Object.assign({},d,i),getPlatform:p,checkPlatform:c}),t}}(window,document);